IDENTIFICATION DIVISION.
PROGRAM-ID. PRG001.
AUTHOR. JORGE OMETTO dia7.
ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT ARQ-CLIENTES
        ASSIGN TO 'CLIENTES.DAT'
        ORGANIZATION IS SEQUENTIAL.
CONFIGURATION SECTION.
SOURCE-COMPUTER. IBM-370.
OBJECT-COMPUTER. IBM-370.
DATA DIVISION.
FILE SECTION.
FD  ARQ-CLIENTES.
01  REG-CLIENTE.
    05 CLI-ID     PIC 9(05).
    05 CLI-NOME   PIC X(30).
WORKING-STORAGE SECTION.
01 WS-VARIAVEIS.
      05 WS-NUMERO     PIC 9(03) VALUE 1.
      05 WS-RESULTADO  PIC 9(03) VALUE 0.
      05 WS-RESTO      PIC 9(01) VALUE 0.
      05 WS-LIMITE       PIC 9(03) VALUE 10.

PROCEDURE DIVISION.

0000-10-ROTINA-PRINCIPAL SECTION.

    PERFORM 0010-10-INICIO THRU 0010-99-EXIT
    PERFORM 0020-10-LE-ARQUIVO THRU 0020-99-EXIT
    PERFORM 0100-10-PROCESSA-REGISTRO THRU 0100-99-EXIT
        UNTIL WS-FIM-ARQ = 'S'
    PERFORM 0900-10-FIM THRU 0900-99-EXIT
    STOP RUN.

0000-99-EXIT. 
      EXIT.

0010-10-INICIO SECTION.
      
    OPEN INPUT ARQ-CLIENTES.
    DISPLAY 'INICIO DO PROCESSAMENTO BATCH'
    DISPLAY ' '.

0010-99-EXIT.
      EXIT.

0020-10-LE-ARQUIVO SECTION.
    READ ARQ-CLIENTES
        AT END
            MOVE 'S' TO WS-FIM-ARQ
        NOT AT END
            ADD 1 TO WS-QTDE-LIDA
    END-READ.
    EXIT.

0100-10-PROCESSA-REGISTRO SECTION.
   
      DISPLAY 'PROCESSANDO REGISTRO: ' WS-NUMERO
      IF WS-FIM-ARQ = 'N'
        DISPLAY 'ID: ' CLI-ID ' NOME: ' CLI-NOME
        PERFORM 0020-10-LE-ARQUIVO
      END-IF.

0100-99-EXIT.
      EXIT.
0900-10-FIM SECTION.
    CLOSE ARQ-CLIENTES
    DISPLAY 'TOTAL DE REGISTROS LIDOS: ' WS-QTDE-LIDA
    DISPLAY 'FIM DO PROCESSAMENTO'.
0900-99-EXIT.
      EXIT.      

